<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SWTMeet - Meeting</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="meeting-style.css">
    <link rel="stylesheet" href="reactions-styles.css">
</head>
<body>

    <!-- Waiting Room Screen -->
    <div class="waiting-room-container" id="waitingRoom" style="display: none;">
        <div class="waiting-room-content">
            <img src="SWTlogo.jpg" alt="SWTMeet" class="waiting-room-logo">
            <h1>Waiting for host to let you in</h1>
            <p class="waiting-room-meeting-title" id="waitingRoomTitle">Loading...</p>
            <div class="waiting-room-spinner">
                <div class="spinner-ring"></div>
                <div class="spinner-ring"></div>
                <div class="spinner-ring"></div>
            </div>
            <p class="waiting-room-message">Please wait, the host will admit you shortly</p>
            <button class="btn-leave-waiting" onclick="leaveWaitingRoom()">Leave</button>
        </div>
    </div>

    <!-- Waiting Room Panel for Host -->
    <div class="waiting-room-panel" id="waitingRoomPanel" style="display: none;">
        <div class="waiting-room-panel-header">
            <h3>Waiting Room (<span id="waitingCount">0</span>)</h3>
            <button class="icon-btn-sm" onclick="closeWaitingRoomPanel()">
                <svg fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
            </button>
        </div>
        <div class="waiting-room-panel-list" id="waitingRoomList">
            <!-- Waiting participants will be added here -->
        </div>
    </div>

    <div class="meeting-container">
        
        <header class="top-bar">
            <img src="SWTlogo.jpg" alt="SWTMeet Logo" class="meeting-logo">
            <div class="meeting-info">
                <span id="meeting-title">Loading...</span> | <span id="time-display">--:--</span>
            </div>
            <div class="layout-controls">
                <span id="meeting-id-display" style="font-size: 0.9rem; color: var(--color-text-med); cursor: pointer;" title="Click to copy">Meeting ID: <span id="meeting-code">------</span></span>
            </div>
        </header>

        <main class="video-grid" id="video-grid">
            <!-- Participants will be dynamically added here by VideoManager -->
        </main>

        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="tab-buttons">
                    <button class="tab-btn active" onclick="showPanel('participants')">Participants (3)</button>
                    <button class="tab-btn" onclick="showPanel('chat')">Chat</button>
                </div>
                <button class="icon-btn close-btn" onclick="toggleSidebar()">
                    <svg fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                </button>
            </div>
            
            <div class="sidebar-content active" id="participants-panel">
                <div class="participants-list" id="participants-list">
                    <!-- Participants will be dynamically added here -->
                </div>
                <div class="participants-footer" id="host-controls-footer" style="display: none;">
                    <div class="host-controls-section">
                        <h4 style="margin-bottom: 12px; font-size: 0.9rem; color: var(--color-text-med);">Host Controls</h4>
                        <button class="btn-host-control" onclick="muteAllParticipants()">
                            <svg fill="currentColor" viewBox="0 0 24 24" width="18" height="18">
                                <path d="M19 11h-1.7c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.49 6-3.31 6-6.72z"/>
                                <path d="M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>
                                <line x1="3" y1="3" x2="21" y2="21" stroke="currentColor" stroke-width="2"/>
                            </svg>
                            Mute All
                        </button>
                        <button class="btn-host-control" onclick="toggleMeetingLock()">
                            <svg fill="currentColor" viewBox="0 0 24 24" width="18" height="18">
                                <path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"/>
                            </svg>
                            <span id="lock-text">Lock Meeting</span>
                        </button>
                        <button class="btn-host-control" onclick="toggleWaitingRoom()">
                            <svg fill="currentColor" viewBox="0 0 24 24" width="18" height="18">
                                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/>
                            </svg>
                            <span id="waiting-room-text">Enable Waiting Room</span>
                        </button>
                        <button class="btn-host-control btn-danger" onclick="endMeetingForAll()">
                            <svg fill="currentColor" viewBox="0 0 24 24" width="18" height="18">
                                <path d="M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6h-1.5z"/>
                                <line x1="1" y1="1" x2="23" y2="23" stroke="currentColor" stroke-width="2"/>
                            </svg>
                            End Meeting for All
                        </button>
                    </div>
                </div>
            </div>

            <div class="sidebar-content" id="chat-panel">
                <div class="chat-messages" id="chat-messages">
                    <!-- Chat messages will be dynamically added here -->
                </div>
                <div class="chat-input-area">
                    <input type="text" id="chat-input" placeholder="Type a message..." onkeypress="if(event.key==='Enter') sendChatMessage()">
                    <button class="icon-btn send-btn" title="Send Message" onclick="sendChatMessage()">
                        <svg fill="currentColor" viewBox="0 0 20 20"><path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 16.5V3a1 1 0 00-1.788-.894l-1 2a1 1 0 001.169 1.409l5-1.429A1 1 0 0010.894 2.553z"></path></svg>
                    </button>
                </div>
            </div>
        </aside>

        <footer class="control-bar">
            <div class="controls-left">
                <div class="control-group">
                    <button class="icon-btn control-btn" id="toggle-mic">
                        <svg fill="currentColor" viewBox="0 0 24 24"><path d="M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zM17.3 11c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.49 6-3.31 6-6.72h-1.7z"></path></svg>
                        <span>Mute</span>
                    </button>
                    <button class="icon-btn control-btn-caret" title="Audio Settings">
                        <svg fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                    </button>
                </div>
                <div class="control-group">
                    <button class="icon-btn control-btn" id="toggle-video">
                        <svg fill="currentColor" viewBox="0 0 24 24"><path d="M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4z"></path></svg>
                        <span>Stop Video</span>
                    </button>
                    <button class="icon-btn control-btn-caret" title="Video Settings">
                        <svg fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                    </button>
                </div>
            </div>

            <div class="controls-center">
                <button class="icon-btn control-btn security" id="toggle-security" title="Security">
                    <svg fill="currentColor" viewBox="0 0 24 24"><path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zM12 11.99h7c-.53 4.12-3.28 7.79-7 8.93V12H5V6.3l7-3.11v8.8z"></path></svg>
                    <span>Security</span>
                </button>
                <button class="icon-btn control-btn" id="toggle-share" title="Share Screen">
                    <svg fill="currentColor" viewBox="0 0 24 24"><path d="M20 18c1.1 0 1.99-.9 1.99-2L22 6c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2H0v2h24v-2h-4zM4 6h16v10H4V6z"></path></svg>
                    <span>Share</span>
                </button>
                <button class="icon-btn control-btn" onclick="toggleSidebar('participants')" title="Participants">
                    <svg fill="currentColor" viewBox="0 0 24 24"><path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"></path></svg>
                    <span>Participants</span>
                </button>
                <button class="icon-btn control-btn" onclick="toggleSidebar('chat')" title="Chat">
                    <svg fill="currentColor" viewBox="0 0 24 24"><path d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM18 14H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"></path></svg>
                    <span>Chat</span>
                </button>
                <button class="icon-btn control-btn" id="toggle-reactions" onclick="toggleReactionsMenu()" title="Reactions">
                    <svg fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm3.5-9c.83 0 1.5-.67 1.5-1.5S16.33 8 15.5 8 14 8.67 14 9.5s.67 1.5 1.5 1.5zm-7 0c.83 0 1.5-.67 1.5-1.5S9.33 8 8.5 8 7 8.67 7 9.5s.67 1.5 1.5 1.5zm3.5 6.5c2.33 0 4.31-1.46 5.11-3.5H6.89c.8 2.04 2.78 3.5 5.11 3.5z"></path></svg>
                    <span>Reactions</span>
                </button>
                <button class="icon-btn control-btn" id="toggle-raise-hand" onclick="toggleRaiseHand()" title="Raise Hand">
                    <svg fill="currentColor" viewBox="0 0 24 24">
                        <path d="M23 5.5V20c0 2.2-1.8 4-4 4h-7.3c-1.08 0-2.1-.43-2.85-1.19L1 14.83s1.26-1.23 1.3-1.25c.22-.19.49-.29.79-.29.22 0 .42.06.6.16.04.01 4.31 2.46 4.31 2.46V4c0-.83.67-1.5 1.5-1.5S11 3.17 11 4v7h1V1.5c0-.83.67-1.5 1.5-1.5S15 .67 15 1.5V11h1V2.5c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5V11h1V5.5c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5z"/>
                    </svg>
                    <span id="raise-hand-text">Raise Hand</span>
                </button>
                <button class="icon-btn control-btn" id="toggle-record" title="Record">
                    <svg fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm-4-4h8v-2H8v2z"></select></svg>
                    <span>Record</span>
                </button>
                <button class="icon-btn control-btn" id="toggle-more" title="More Options">
                    <svg fill="currentColor" viewBox="0 0 24 24"><path d="M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"></path></svg>
                    <span>More</span>
                </button>
            </div>
            
            <div class="controls-right">
                <button class="btn-leave">Leave</button>
            </div>
        </footer>
        
        <!-- Footer Background (Behind Controls) -->
        <div class="meeting-footer"></div>
        
        <!-- Reactions Menu -->
        <div class="reactions-menu" id="reactionsMenu">
            <button class="reaction-btn" onclick="sendReaction('üëç')" title="Thumbs Up">üëç</button>
            <button class="reaction-btn" onclick="sendReaction('üëè')" title="Clap">üëè</button>
            <button class="reaction-btn" onclick="sendReaction('‚ù§Ô∏è')" title="Heart">‚ù§Ô∏è</button>
            <button class="reaction-btn" onclick="sendReaction('üòÇ')" title="Laugh">üòÇ</button>
            <button class="reaction-btn" onclick="sendReaction('üòÆ')" title="Surprised">üòÆ</button>
            <button class="reaction-btn" onclick="sendReaction('üéâ')" title="Party">üéâ</button>
        </div>

    </div>

    <!-- Supabase JS SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="config/supabase.js"></script>
    
    <!-- Load VideoManager FIRST -->
    <script src="video-manager.js"></script>
    <script src="smart-layout-manager.js"></script>
    <script src="webrtc-signaling.js"></script>
    
    <!-- Then load meeting script -->
    <script src="meeting-script.js"></script>
    <script src="reactions.js"></script>
    <script src="raise-hand.js"></script>

</body>
</html>